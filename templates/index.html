<html>
<head>
<script src="https://d3js.org/d3.v4.min.js"></script>

<style>
#main{
  background-color: #eee;
}
</style>
</head>

<body>

<h1>Hello!</h1>
<p>select exp</p>
<p>select chr or all chr</p>
<p>scale slider</p>

<input id='sBinSize' type='range' min=5 max=20000 step=5 
       onchange="showBinSize(this.value)"/>
<p id="binSize">bin size: </p>

<div>
<svg id='main'></svg>
</div>
<script>
'use strict';
function showBinSize(value){
  document.getElementById('binSize').innerHTML = value;
}

//setting
var width = window.innerWidth;
var height = 500;
var margin = 20;

//scaleX,Y, colorscale
var sx, sy, sc;
var mainPlot;
var lines = [];


function init(){
  mainPlot = d3.select('#main')
  .attr('width', width)
  .attr('height',height);
  //scaleX,Y
  sx = d3.scaleLinear().range([margin, width-margin]);
  sy = d3.scaleLinear().range([height-margin, margin]);
  //colorscale
  sc = d3.scaleOrdinal(d3.schemeCategory20);

}


function Line(histData){
  var bin_edges = histData['bin_edges'];
  var hist = histData['hist'];
  return d3.line()
    .curve(d3.curveLinear)
    //.curve(d3.curveBundle)
    .x(function(d,i){return sx(bin_edges[i])})
    .y(function(d){return sy(d)});
}


function add(exp, binsize, name=''){
  d3.json('/exp/'+exp+'_'+binsize+'.json', function(err, res){
    var chrs = Object.keys(res).sort();
    var c = chrs[1]//select random chromosome;
    var histData = res[c];

    var bin_edges = histData['bin_edges'];
    var hist = histData['hist'];
    var xmin = Math.min(sx.domain()[0], bin_edges[0]);

    //set domain according to first added path
    if(!sx.isDomainSet){
      setDomain([bin_edges[0], bin_edges[bin_edges.length-1]],
                d3.extent(hist));
      sx.isDomainSet = true;
    }

    var line = Line(histData);

    var path = mainPlot.append('path')
    .datum(hist)
    .attr('class', ''+exp + ' bin' + binsize)
    .attr('fill', 'none')
    .attr('stroke', sc(lines.length))
    .attr('stroke-width', 3)
    .attr('d', line);

    lines.push({
                'binsize':binsize, 
                'path':path,
                'eid': exp,
                'chr': c,
                'name': name
              });

  });

  
}

function setDomain(x,y){
  sx.domain(x);
  sy.domain(y);
}

function setBinSize(size){
  
}


function main(){
  init();
  add(10838, 10000);
}

main();
</script>
</body>
</html>